<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Xanadu Tennis • Recommender (Clean v3)</title>
<style>
  /* 明亮风格 */
  body{margin:0;background:#ffffff;color:#1f2937;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .topbar{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid #e5e7eb;
          display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
  .topbar .brand{font-weight:700}
  .wrap{min-height:100vh;display:flex;justify-content:center}
  .stage{width:100%;max-width:980px;margin:calc(62vh - 360px) auto 32px; /* 靠上：近黄金分割 */
         padding:0 16px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:18px;
        box-shadow:0 6px 20px #0000000d}
  h1{margin:0 0 12px;font-size:22px}
  .q{font-weight:700;margin:8px 0 6px}
  .choices{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin:10px 0}
  .opt{padding:12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;cursor:pointer;text-align:center}
  .opt:hover{background:#f9fafb}
  .footer{display:flex;gap:10px;justify-content:space-between;margin-top:14px}
  .btn{border:none;border-radius:12px;padding:10px 12px;background:#f97316;color:#fff;cursor:pointer}
  .btn.alt{background:#0f766e}
  .btn.ghost{background:#fff;color:#1f2937;border:1px solid #e5e7eb}
  .hr{height:1px;background:#e5e7eb;margin:14px 0}
  .panel{background:#f9fafb;border:1px solid #e5e7eb;border-radius:14px;padding:12px}
  table{width:100%;border-collapse:collapse;margin:8px 0}
  th,td{border:1px solid #e5e7eb;padding:8px;text-align:left}
  th{background:#f9fafb}
  .recgrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
  input,textarea{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
  textarea{min-height:88px}
  label{font-size:14px;color:#6b7280}
  .muted{color:#6b7280}
  #err{display:none;white-space:pre-wrap;margin-top:8px;color:#b91c1c;background:#fff7ed;border:1px solid #fed7aa;padding:10px;border-radius:10px}
</style>
</head>
<body>
  <div class="topbar">
    <div class="brand">Toronto Xanadu Tennis • Recommender</div>
    <button class="btn ghost" onclick="restartAll()">Restart / 重新开始</button>
  </div>

  <div class="wrap">
    <div class="stage">
      <div id="app" class="card">...</div>
      <div id="err"></div>
    </div>
  </div>

<script>
/* 防止空白：把错误显示在页面上 */
window.onerror = function(msg, src, line, col){
  var e=document.getElementById('err');
  e.style.display='block';
  e.textContent = 'Error: '+msg+'\\n'+(src||'')+':'+line+':'+col;
};

/* 文案（单语显示：先选语言，之后只显示该语言） */
var STR = {
  zh:{ title:'课程推荐（智能分档）', lang:'请选择语言', zh:'中文', en:'English',
       audience:'请选择报名对象', adult:'成人 (14+)', child:'儿童 U14',
       a_level:'请选择成人当前水平', zero:'零基础', basic:'有一定基础', inter:'能对打/发球', adv:'能比赛',
       k_mode:'请选择儿童课程模式', flex:'短期 Flex', longterm:'长期 固定周课',
       group:'更偏好的上课人数？', g1:'1v1', g2:'1v2', g3:'1v3', g4:'1v4', g46:'1v4–6',
       join:'是否可自带队友或接受拼班？', j_bring:'我能带1–3位朋友', j_join:'愿意拼班（由我们匹配）', j_none:'都不方便',
       sched:'时间偏好', wd:'工作日白天', we:'工作日晚间', wk:'周末', flex2:'都可以',
       freq:'每周计划上课频次', f1:'1×/周', f2:'2×/周', f3:'3×+/周',
       hours:'请选择课时/学期', h10:'10小时', h15:'15小时', t25:'半年(25周)', t50:'一年(50周)',
       rec:'为您生成的推荐', main:'最匹配', alt:'其他可选',
       price_all:'完整价目表',
       adult_zero:'成人 · 零基础（红球场）', adult_basic:'成人 · 进阶专项（半场）', adult_full:'成人 · 定制训练（全场）',
       kid_flex:'U14 · 短期 Flex', kid_lt:'U14 · 长期固定（半年/一年）',
       contact:'请留下联系方式，我们将在 24 小时内联系您完成报课',
       name:'姓名', phone:'手机号', email:'邮箱', wechat:'微信号(可选)', notes:'备注(可填年龄/可用时间)',
       submit:'提交', submitted:'已提交！我们会在 24 小时内联系您完成报课。', restart:'重新开始'
  },
  en:{ title:'Course Recommender (Smart)', lang:'Choose your language', zh:'中文', en:'English',
       audience:'Who is this for?', adult:'Adult (14+)', child:'Child (U14)',
       a_level:'Select your current level', zero:'True beginner', basic:'Some basics', inter:'Can rally/serve', adv:'Match-ready',
       k_mode:'Select course mode', flex:'Short-term Flex', longterm:'Long-term weekly',
       group:'Preferred class size?', g1:'1v1', g2:'1v2', g3:'1v3', g4:'1v4', g46:'1v4–6',
       join:'Can you bring friends or join matching?', j_bring:'I can bring 1–3 friends', j_join:'Happy to be matched', j_none:'Prefer not',
       sched:'Schedule preference', wd:'Weekday daytime', we:'Weekday evening', wk:'Weekend', flex2:'Flexible',
       freq:'Sessions per week', f1:'1×/week', f2:'2×/week', f3:'3×+/week',
       hours:'Choose hours/term', h10:'10 hours', h15:'15 hours', t25:'Half-year (25 weeks)', t50:'Full-year (50 weeks)',
       rec:'Your recommendations', main:'Best match', alt:'Other options',
       price_all:'Full Price List',
       adult_zero:'Adults · True Beginner (Red court)', adult_basic:'Adults · Skill Focus (Half court)', adult_full:'Adults · Custom (Full court)',
       kid_flex:'U14 · Short-term Flex', kid_lt:'U14 · Long-term (Half/Full year)',
       contact:'Leave your contact. We will reach out within 24 hours to complete your registration.',
       name:'Full Name', phone:'Phone', email:'Email', wechat:'WeChat (optional)', notes:'Notes (availability, age, etc.)',
       submit:'Submit', submitted:'Submitted! We will contact you within 24 hours to complete your registration.', restart:'Restart'
  }
};
function t(k){ return STR[S.lang||'zh'][k]; }

/* 价目（中文源；英文界面时自动转成纯英文） */
var PRICE = {
  adult_zero:[['1v1 10hr','$800/人','试课$100'],['1v1 20hr','$1550/人','95折'],['1v2 10hr','$1000/共','试课$140'],['1v2 20hr','$1900/共',''],['1v3 15hr','$1500/共','试课$240'],['1v4 15hr','$1800/共','试课$280']],
  adult_basic:[['1v1 10hr','$900/人','试课$110'],['1v1 20hr','$1710/人',''],['1v2 10hr','$1250/共','试课$150'],['1v2 20hr','$2375/共',''],['1v3 15hr','$1500/共','试课$240'],['1v4 15hr','$1800/共','试课$280']],
  adult_full:[['1v1 10hr','$1300/人','试课$140'],['1v1 20hr','$2470/人',''],['1v2 10hr','$1500/共','试课$160'],['1v2 20hr','$2850/共',''],['1v3 15hr','$2400/共','试课$270'],['1v4 15hr','$2800/共','试课$320']],
  kid_flex:[['1v1 10hr','$900/人','试课$100'],['1v2 10hr','$1250/共','试课$140'],['1v3 15hr','$500/人','试课$240'],['1v4 15hr','$450/人','试课$280']]
};
var K_LT = {
  '1v1':{'1pw':{'25':['$1875','(75/hr)'],'50':['$3600','(72/hr)']},'2pw':{'25':['$3550','(71/hr)'],'50':['$6700','(67/hr)']},'3pw':{'25':['$4875','(65/hr)'],'50':['$9300','(62/hr)']}},
  '1v2':{'1pw':{'25':['$2375','(95/hr)'],'50':['$4600','(92/hr)']},'2pw':{'25':['$4550','(91/hr)'],'50':['$8700','(87/hr)']},'3pw':{'25':['$6375','(85/hr)'],'50':['$12100','(80.67/hr)']}},
  '1v3':{'1pw':{'25':['$3000','(120/hr)'],'50':['$5850','(117/hr)']},'2pw':{'25':['$5750','(115/hr)'],'50':['$11000','(110/hr)']},'3pw':{'25':['$8025','(107/hr)'],'50':['$15500','(103.33/hr)']}},
  '1v4-6':{'1pw':{'25':['$3650','(146/hr)'],'50':['$7150','(143/hr)']},'2pw':{'25':['$7050','(141/hr)'],'50':['$13650','(136.5/hr)']},'3pw':{'25':['$10050','(134/hr)'],'50':['$19500','(130/hr)']}}
};

/* 状态 */
var S = {lang:null, audience:null, a_level:null, k_mode:null, group:null, join:null, sched:null, freq:null, k_group:null, k_join:null, k_sched:null, k_freq:null, k_term:null, submitted:false};
var app = document.getElementById('app');

/* 小工具 */
function zh2enCell(x){
  return x.replace('/人',' per person').replace('/共',' per group').replace('试课','$ Trial ').replace('小时',' hours').replace('95折','5% off');
}
function localizeRows(rows){
  if((S.lang||'zh')==='zh') return rows;
  var out=[], i;
  for(i=0;i<rows.length;i++){
    out.push([ zh2enCell(rows[i][0]), zh2enCell(rows[i][1]), zh2enCell(rows[i][2]||'') ]);
  }
  return out;
}
function table(rows){
  var R = localizeRows(rows);
  var th1=(S.lang==='en')?'Package':'套餐', th2=(S.lang==='en')?'Price':'价格', th3=(S.lang==='en')?'Note':'备注';
  var html = '<table><thead><tr><th>'+th1+'</th><th>'+th2+'</th><th>'+th3+'</th></tr></thead><tbody>';
  var i;
  for(i=0;i<R.length;i++){
    html += '<tr><td>'+R[i][0]+'</td><td>'+R[i][1]+'</td><td>'+(R[i][2]||'')+'</td></tr>';
  }
  html += '</tbody></table>';
  return html;
}
function tableKLT(){
  var groups=['1v1','1v2','1v3','1v4-6'], freqs=['1pw','2pw','3pw'];
  var thF=(S.lang==='en')?'Freq':'频次', th25=(S.lang==='en')?'25 weeks':'25周', th50=(S.lang==='en')?'50 weeks':'50周';
  var i,j,html=''; 
  for(i=0;i<groups.length;i++){
    html+='<div class="card"><div class="q">'+groups[i]+'</div><table><thead><tr><th>'+thF+'</th><th>'+th25+'</th><th>'+th50+'</th></tr></thead><tbody>';
    for(j=0;j<freqs.length;j++){
      var c25=K_LT[groups[i]][freqs[j]]['25'].join(' ');
      var c50=K_LT[groups[i]][freqs[j]]['50'].join(' ');
      html+='<tr><td>'+freqs[j]+'</td><td>'+c25+'</td><td>'+c50+'</td></tr>';
    }
    html+='</tbody></table></div>';
  }
  return html;
}
function opt(label, call){ return '<div class="opt" onclick="'+call+'">'+label+'</div>'; }

/* 推荐依据：场地利用率 */
function PEAK(s){ return s==='we' || s==='wk'; }
function tierFromAdultLevel(){ return S.a_level==='zero' ? 'zero' : (S.a_level==='basic' ? 'basic' : 'full'); }
function tableByTier(tier){ return tier==='zero'? PRICE.adult_zero : (tier==='basic'? PRICE.adult_basic : PRICE.adult_full); }
function findRow(rows, group, hours){
  var i, key = group+' '+hours+'hr';
  for(i=0;i<rows.length;i++){ if(rows[i][0].indexOf(key)===0) return rows[i]; }
  return null;
}
function chooseHours(group){ return (group==='1v1'||group==='1v2') ? ((S.freq==='f2'||S.freq==='f3')?20:10) : 15; }
function pickGroupByUtil(group){
  if(PEAK(S.sched)){
    if(group==='1v1') return (S.join==='j_bring'||S.join==='j_join') ? '1v2' : '1v1';
    if(group==='1v2') return '1v3';
    if(group==='1v3') return '1v4';
  }
  return group;
}
function buildAdultRec(){
  var tier=tierFromAdultLevel(), tableX=tableByTier(tier);
  var g=S.group||'1v2'; if(g==='1v1') S.join='j_none';
  g = pickGroupByUtil(g);
  var h=chooseHours(g); 
  var main = findRow(tableX,g,h) || tableX[0];
  var other=[], order=['1v1','1v2','1v3','1v4'], i;
  for(i=0;i<order.length;i++){
    var gg=order[i]; if(gg===g) continue;
    var rr = findRow(tableX, gg, chooseHours(gg)); if(rr) other.push(rr);
  }
  return {main:main, other:other};
}
function buildKidsRec(){
  if(S.k_mode==='flex'){
    var t=PRICE.kid_flex, g=S.k_group||'1v2', h=(g==='1v1'||g==='1v2')?10:15;
    var main=findRow(t,g,h) || t[0];
    var other=[], order=['1v1','1v2','1v3','1v4'], i;
    for(i=0;i<order.length;i++){ var gg=order[i]; if(gg===g) continue;
      var rr=findRow(t, gg, (gg==='1v1'||gg==='1v2')?10:15); if(rr) other.push(rr);
    }
    return {main:main, other:other};
  }else{
    var freqMap={f1:'1pw',f2:'2pw',f3:'3pw'};
    var g2=S.k_group||'1v2', term=S.k_term||'25', f=freqMap[S.k_freq||'f1'];
    function toRow(gg){ var tuple=K_LT[gg][f][term]; return [gg+' '+f, tuple[0], tuple[1]]; }
    var main2=toRow(g2), other2=[], order2=['1v1','1v2','1v3','1v4-6'], i2;
    for(i2=0;i2<order2.length;i2++){ if(order2[i2]!==g2) other2.push(toRow(order2[i2])); }
    return {main:main2, other:other2};
  }
}

/* 提交表单 */
function contactBlock(){
  var zh = (S.lang==='zh'), html='';
  html += '<div class="hr"></div><div class="q">'+t('contact')+'</div>';
  html += '<div class="grid">';
  html += '<div class="card"><label>'+t('name')+'<br><input id="c_name" type="text"></label></div>';
  html += '<div class="card"><label>'+t('phone')+'<br><input id="c_phone" type="tel"></label></div>';
  html += '<div class="card"><label>'+t('email')+'<br><input id="c_email" type="email"></label></div>';
  if(zh) html += '<div class="card"><label>'+t('wechat')+'<br><input id="c_wechat" type="text"></label></div>';
  html += '</div>';
  html += '<div class="card" style="margin-top:8px"><label>'+t('notes')+'<br><textarea id="c_notes"></textarea></label></div>';
  html += '<div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button><button class="btn alt" onclick="submitLead()">'+t('submit')+'</button></div>';
  return html;
}
function submitLead(){
  var name=document.getElementById('c_name').value.trim();
  var phone=document.getElementById('c_phone').value.trim();
  var email=document.getElementById('c_email').value.trim();
  if(!name||!phone||!email){ alert((S.lang==='zh')?'请填写姓名/电话/邮箱':'Please fill name/phone/email'); return; }
  S.submitted = true;
  render();
}

/* 事件：把所有 setter 暴露成全局，避免内联复杂表达式 */
function setLang(v){ S.lang=v; render(); }
function setAudience(v){ S.audience=v; render(); }
function setALevel(v){ S.a_level=v; render(); }
function setGroup(v){ S.group=v; render(); }
function setJoin(v){ S.join=v; render(); }
function setSched(v){ S.sched=v; render(); }
function setFreq(v){ S.freq=v; render(); }
function setKMode(v){ S.k_mode=v; render(); }
function setKGroup(v){ S.k_group=v; render(); }
function setKJoin(v){ S.k_join=v; render(); }
function setKSched(v){ S.k_sched=v; render(); }
function setKFreq(v){ S.k_freq=v; render(); }
function setKTerm(v){ S.k_term=v; render(); }

function restartAll(){
  S = {lang:null, audience:null, a_level:null, k_mode:null, group:null, join:null, sched:null, freq:null, k_group:null, k_join:null, k_sched:null, k_freq:null, k_term:null, submitted:false};
  render();
}

/* 渲染主流程（逐页 + 每页都有 restart 按钮在顶部/底部） */
function render(){
  var html = '';
  if(S.submitted){
    html += '<h1>'+t('title')+'</h1>';
    html += '<div class="card" style="text-align:center"><div style="font-size:18px;margin:8px 0">'+t('submitted')+'</div>';
    html += '<div class="footer" style="justify-content:center"><button class="btn" onclick="restartAll()">'+t('restart')+'</button></div></div>';
    app.innerHTML = html; return;
  }

  if(!S.lang){
    html += '<h1>'+STR.en.title+' / '+STR.zh.title+'</h1>';
    html += '<div class="q">'+STR.en.lang+'</div>';
    html += '<div class="choices">'+
              opt(STR.zh.zh,"setLang('zh')")+
              opt(STR.en.en,"setLang('en')")+
            '</div>';
    app.innerHTML = html; return;
  }

  if(!S.audience){
    html += '<h1>'+t('title')+'</h1>';
    html += '<div class="q">'+t('audience')+'</div>';
    html += '<div class="choices">'+
              opt(t('adult'),"setAudience('adult')")+
              opt(t('child'),"setAudience('child')")+
            '</div>';
    html += '<div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
    app.innerHTML = html; return;
  }

  if(S.audience==='adult'){
    if(!S.a_level){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('a_level')+'</div><div class="choices">'+
              opt(t('zero'),"setALevel('zero')")+opt(t('basic'),"setALevel('basic')")+opt(t('inter'),"setALevel('inter')")+opt(t('adv'),"setALevel('adv')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(!S.group){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('group')+'</div><div class="choices">'+
              opt('1v1',"setGroup('1v1')")+opt('1v2',"setGroup('1v2')")+opt('1v3',"setGroup('1v3')")+opt('1v4',"setGroup('1v4')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(S.group!=='1v1' && !S.join){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('join')+'</div><div class="choices">'+
              opt(t('j_bring'),"setJoin('j_bring')")+opt(t('j_join'),"setJoin('j_join')")+opt(t('j_none'),"setJoin('j_none')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    } else if(S.group==='1v1'){ S.join='j_none'; }
    if(!S.sched){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('sched')+'</div><div class="choices">'+
              opt(t('wd'),"setSched('wd')")+opt(t('we'),"setSched('we')")+opt(t('wk'),"setSched('wk')")+opt(t('flex2'),"setSched('flex')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(!S.freq){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('freq')+'</div><div class="choices">'+
              opt(t('f1'),"setFreq('f1')")+opt(t('f2'),"setFreq('f2')")+opt(t('f3'),"setFreq('f3')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }

    var recA = buildAdultRec();
    var mainA = localizeRows([recA.main])[0];
    var othersA = recA.other;
    var i;
    html += '<h1>'+t('title')+'</h1><div class="q">'+t('rec')+'</div><div class="recgrid">';
    html += '<div class="card"><div class="muted">'+t('main')+'</div><div class="q">'+mainA[0]+'</div><div>'+mainA[1]+'</div><div class="muted">'+(mainA[2]||'')+'</div></div>';
    for(i=0;i<othersA.length;i++){
      var r = localizeRows([othersA[i]])[0];
      html += '<div class="card"><div class="muted">'+t('alt')+'</div><div class="q">'+r[0]+'</div><div>'+r[1]+'</div><div class="muted">'+(r[2]||'')+'</div></div>';
    }
    html += '</div><div class="hr"></div>';
    html += '<div class="panel"><h3 style="margin:6px 0">'+t('price_all')+'</h3><div class="grid">'+
              '<div class="card"><div class="q">'+t('adult_zero')+'</div>'+table(PRICE.adult_zero)+'</div>'+
              '<div class="card"><div class="q">'+t('adult_basic')+'</div>'+table(PRICE.adult_basic)+'</div>'+
              '<div class="card"><div class="q">'+t('adult_full')+'</div>'+table(PRICE.adult_full)+'</div>'+
            '</div></div>';
    html += contactBlock();
    app.innerHTML = html; return;
  }

  /* 儿童路径 */
  if(S.audience==='child'){
    if(!S.k_mode){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('k_mode')+'</div><div class="choices">'+
              opt(t('flex'),"setKMode('flex')")+opt(t('longterm'),"setKMode('longterm')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(!S.k_group){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('group')+'</div><div class="choices">'+
              opt('1v1',"setKGroup('1v1')")+opt('1v2',"setKGroup('1v2')")+opt('1v3',"setKGroup('1v3')")+opt('1v4-6',"setKGroup('1v4-6')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(!S.k_join){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('join')+'</div><div class="choices">'+
              opt(t('j_bring'),"setKJoin('j_bring')")+opt(t('j_join'),"setKJoin('j_join')")+opt(t('j_none'),"setKJoin('j_none')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(!S.k_sched){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('sched')+'</div><div class="choices">'+
              opt(t('wd'),"setKSched('wd')")+opt(t('we'),"setKSched('we')")+opt(t('wk'),"setKSched('wk')")+opt(t('flex2'),"setKSched('flex')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(!S.k_freq){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('freq')+'</div><div class="choices">'+
              opt(t('f1'),"setKFreq('f1')")+opt(t('f2'),"setKFreq('f2')")+opt(t('f3'),"setKFreq('f3')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(S.k_mode==='flex' && !S.k_term){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('hours')+'</div><div class="choices">'+
              opt(t('h10'),"setKTerm('10')")+opt(t('h15'),"setKTerm('15')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }
    if(S.k_mode==='longterm' && !S.k_term){
      html += '<h1>'+t('title')+'</h1><div class="q">'+t('hours')+'</div><div class="choices">'+
              opt(t('t25'),"setKTerm('25')")+opt(t('t50'),"setKTerm('50')")+
              '</div><div class="footer"><button class="btn ghost" onclick="restartAll()">'+t('restart')+'</button></div>';
      app.innerHTML=html;return;
    }

    var recK = buildKidsRec();
    var mainK = localizeRows([recK.main])[0];
    var othersK = recK.other;
    var k;
    html += '<h1>'+t('title')+'</h1><div class="q">'+t('rec')+'</div><div class="recgrid">';
    html += '<div class="card"><div class="muted">'+t('main')+'</div><div class="q">'+mainK[0]+'</div><div>'+mainK[1]+'</div><div class="muted">'+(mainK[2]||'')+'</div></div>';
    for(k=0;k<othersK.length;k++){
      var ry = localizeRows([othersK[k]])[0];
      html += '<div class="card"><div class="muted">'+t('alt')+'</div><div class="q">'+ry[0]+'</div><div>'+ry[1]+'</div><div class="muted">'+(ry[2]||'')+'</div></div>';
    }
    html += '</div><div class="hr"></div>';
    html += '<div class="panel"><h3 style="margin:6px 0">'+t('price_all')+'</h3><div class="grid">'+
              '<div class="card"><div class="q">'+t('kid_flex')+'</div>'+table(PRICE.kid_flex)+'</div>'+
              '<div class="card"><div class="q">'+t('kid_lt')+'</div>'+tableKLT()+'</div>'+
            '</div></div>';
    html += contactBlock();
    app.innerHTML = html; return;
  }
}

/* 初始渲染 */
render();
</script>
</body>
</html>
